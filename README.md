üöÄ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏ –¥–ª—è STM32 —Å –≤—ã–≤–æ–¥–æ–º "kirill" –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ Renode
üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–û

–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏

–°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–º—É–ª—è—Ü–∏–∏

–ó–∞–ø—É—Å–∫ –≤ Renode

–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ:
Visual Studio Code - —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞

PlatformIO IDE - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è VS Code

Renode - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

Git (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:
–¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç–∞: STM32 BluePill (STM32F103C8T6)

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: ARM Cortex-M3

üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–û
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Visual Studio Code
–°–∫–∞—á–∞–π—Ç–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PlatformIO
–û—Ç–∫—Ä–æ–π—Ç–µ VS Code

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Extensions (Ctrl+Shift+X)

–ù–∞–π–¥–∏—Ç–µ "PlatformIO IDE"

–ù–∞–∂–º–∏—Ç–µ Install

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Renode
–°–∫–∞—á–∞–π—Ç–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è –≤–∞—à–µ–π –û–°

üéØ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
–°–ø–æ—Å–æ–± A: –ß–µ—Ä–µ–∑ PlatformIO Home
–û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å PlatformIO (–∏–∫–æ–Ω–∫–∞ üè† —Å–ª–µ–≤–∞)

–ù–∞–∂–º–∏—Ç–µ PIO Home ‚Üí New Project

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

Name: stm32_kirill_emulator

Board: BluePill F103C8

Framework: STM32Cube

Location: –≤—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é –ø–∞–ø–∫—É

–°–ø–æ—Å–æ–± B: –ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª
bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
mkdir stm32_kirill_emulator
cd stm32_kirill_emulator

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PlatformIO –ø—Ä–æ–µ–∫—Ç–∞
pio project init --board bluepill_f103c8 --framework stm32cube
‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–§–∞–π–ª platformio.ini
–ó–∞–º–µ–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ platformio.ini –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

ini
; PlatformIO Configuration for STM32 BluePill
[env:bluepill_f103c8]
platform = ststm32
board = bluepill_f103c8
framework = stm32cube

; Build configuration
build_flags = 
    -D STM32F103xB
    -D HAL_UART_MODULE_ENABLED

; Debug settings
debug_tool = stlink
upload_protocol = stlink

; Optimization
build_type = release
üíª –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏
1. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ PlatformIO –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
mkdir src
2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏
–§–∞–π–ª: src/main.c

c
/**
 * STM32 Firmware for Renode Emulator
 * Outputs "kirill" via UART every second
 * Board: STM32F103C8T6 (BluePill)
 */

// Direct register access - no external dependencies
int main(void) {
    // STM32F103 Register Definitions
    volatile unsigned int* RCC_APB2ENR  = (unsigned int*)0x40021018;  // Clock control
    volatile unsigned int* GPIOA_CRH    = (unsigned int*)0x40010804;  // Port A config
    volatile unsigned int* USART1_BRR   = (unsigned int*)0x40013808;  // Baud rate
    volatile unsigned int* USART1_CR1   = (unsigned int*)0x4001380C;  // Control
    volatile unsigned int* USART1_SR    = (unsigned int*)0x40013800;  // Status
    volatile unsigned int* USART1_DR    = (unsigned int*)0x40013804;  // Data
    
    // Enable clocks for GPIOA and USART1
    *RCC_APB2ENR |= (1 << 2) | (1 << 14);
    
    // Configure PA9 as TX pin (Alternate function output)
    *GPIOA_CRH = (*GPIOA_CRH & ~0x000000F0) | 0x00000090;
    
    // Configure USART1: 115200 baud, 8N1, Transmitter enabled
    *USART1_BRR = 0x0341;  // 115200 baud @ 8MHz
    *USART1_CR1 = (1 << 13) | (1 << 3);  // UE + TE
    
    // Message to transmit
    char message[] = "kirill\n";
    
    // Main program loop
    while(1) {
        // Transmit each character
        for(int i = 0; message[i] != '\0'; i++) {
            // Wait for transmit buffer empty
            while(!(*USART1_SR & (1 << 7)));
            // Send character
            *USART1_DR = message[i];
        }
        
        // Simple delay ~1 second
        for(volatile int delay = 0; delay < 1000000; delay++);
    }
    
    return 0;
}
üî® –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
1. –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–±–æ—Ä–æ–∫
bash
pio run -t clean
2. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ—à–∏–≤–∫–∏
bash
pio run
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ ELF —Ñ–∞–π–ª–∞
dir .pio\build\bluepill_f103c8\firmware.elf

# –ò–ª–∏ –¥–ª—è Linux/Mac:
ls -la .pio/build/bluepill_f103c8/firmware.elf
–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:

text
[SUCCESS] Took X.XX seconds
üéÆ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–º—É–ª—è—Ü–∏–∏
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ –ø—Ä–æ—à–∏–≤–∫–∏
bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ELF —Ñ–∞–π–ª –≤ –ø—Ä–æ—Å—Ç–æ–µ –º–µ—Å—Ç–æ
copy .pio\build\bluepill_f103c8\firmware.elf C:\firmware.elf

# –ò–ª–∏ –¥–ª—è Linux/Mac:
cp .pio/build/bluepill_f103c8/firmware.elf /tmp/firmware.elf
2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Renode
–§–∞–π–ª: renode_config.resc

python
# Renode Configuration for STM32 Kirill Emulator
# Description: Loads and runs STM32 firmware that outputs "kirill" via UART

using sysbus

# Create new machine instance
mach create "stm32_kirill"

# Load STM32F103 platform description
machine LoadPlatformDescription @platforms/cpus/stm32f103.repl

# Load compiled firmware
sysbus LoadELF "C:/firmware.elf"
# For Linux/Mac: sysbus LoadELF "/tmp/firmware.elf"

# Create and show UART analyzer for output
showAnalyzer sysbus.usart1

# Optional: Set up logging
logLevel -1

# Start emulation
echo "Starting STM32 emulation..."
echo "Expected output: 'kirill' every second"
machine Start
üöÄ –ó–∞–ø—É—Å–∫ –≤ Renode
–°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
bash
renode renode_config.resc
–°–ø–æ—Å–æ–± 2: –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∫–æ–º–∞–Ω–¥
–ó–∞–ø—É—Å—Ç–∏—Ç–µ Renode

–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

python
mach create
machine LoadPlatformDescription @platforms/cpus/stm32f103.repl
sysbus LoadELF "C:/firmware.elf"
showAnalyzer sysbus.usart1
start
–°–ø–æ—Å–æ–± 3: –ó–∞–ø—É—Å–∫ —Å –ª–æ–≥–∞–º–∏
bash
renode --console renode_config.resc
‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

–û–∫–Ω–æ Renode —Å –ª–æ–≥–∞–º–∏ –∑–∞–ø—É—Å–∫–∞

–û–∫–Ω–æ UART –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –≤—ã–≤–æ–¥–æ–º

–ü–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É:

text
kirill
kirill
kirill
...
üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π
‚ùå –ü—Ä–æ–±–ª–µ–º–∞: "undefined reference to main"
–†–µ—à–µ–Ω–∏–µ: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ src/main.c –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è main

‚ùå –ü—Ä–æ–±–ª–µ–º–∞: "multiple definition of SystemInit"
–†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–º–∞–Ω–¥—ã PlatformIO –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
–†–µ—à–µ–Ω–∏–µ:

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª —á–µ—Ä–µ–∑ PIO Core CLI

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: C:\Users\[user]\.platformio\penv\Scripts\platformio.exe

‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –≤—ã–≤–æ–¥–∞ –≤ Renode
–†–µ—à–µ–Ω–∏–µ: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π UART:

python
showAnalyzer sysbus.usart2  # –í–º–µ—Å—Ç–æ usart1
‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø—É—Ç–∏ –≤ Renode
–†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –≤ –∫–æ—Ä–µ–Ω—å –¥–∏—Å–∫–∞

‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–∞–º–∏
–†–µ—à–µ–Ω–∏–µ:

bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
pio run -t clean
pio run -v  # –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
text
stm32_kirill_emulator/
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ main.c                 # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ—à–∏–≤–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ platformio.ini            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PlatformIO
‚îú‚îÄ‚îÄ renode_config.resc        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Renode
‚îÇ
‚îî‚îÄ‚îÄ .pio/                     # –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
    ‚îî‚îÄ‚îÄ build/
        ‚îî‚îÄ‚îÄ bluepill_f103c8/
            ‚îú‚îÄ‚îÄ firmware.elf  # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞
            ‚îú‚îÄ‚îÄ firmware.bin
            ‚îî‚îÄ‚îÄ firmware.hex
üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!
–í—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ –∏ –∑–∞–ø—É—Å—Ç–∏–ª–∏ –ø—Ä–æ—à–∏–≤–∫—É STM32 –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ Renode. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ:

‚úÖ –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –¥–ª—è –≤—ã–≤–æ–¥–∞ –¥—Ä—É–≥–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
